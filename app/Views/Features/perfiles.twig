{% extends 'Layouts/main.twig' %} {% block content %}

{% block cssAPP %}
<link rel="stylesheet" href="{{ base_url('assets/css/data-table.css') }}">

<style>
   .image-button:hover {
      transform: scale(1.05);
      /* Escala la imagen ligeramente */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      /* Agrega sombra */
   }

   .icono-bg {
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
   }

   .icono-bg.candadito {
      background-image: url("{{ icons('padlock-icon.png') }}");
   }

   .icono-bg.semaforo-amarillo {
      background-image: url("{{ icons('semaforo-amarillo-icon.png') }}");
   }

   .icono-bg.semaforo-rojo {
      background-image: url("{{ icons('semaforo-rojo-icon.png') }}");
   }

   .icono-bg.llave {
      background-image: url("{{ icons('llave-icon.png') }}");
   }

   .tachado {
      text-decoration: line-through;
   }
</style>

<script>
   function changeInput(id){
        $("#frp_user_id").val(id);
    }
</script>

{% endblock %}

<div class="container-fluid">

   <div class="row">
      <div class="col-sm-12">
         <div class="iq-card">
            <div class="iq-card-header d-flex justify-content-between">
               <div class="iq-header-title">
                  <h4 class="card-title">Administración de Perfiles</h4>
               </div>
               <div class="iq-card-header-toolbar d-flex align-items-center">
                  <a href="{{base_url('gestion/nuevoperfil')}}" class="btn btn-primary"><i class="fa fa-plus"
                        aria-hidden="true"></i>Nuevo Perfil</a>
               </div>
            </div>
            <div class="iq-card-body">
               <div class="table-responsive">
                  <table id="datatable" class="table table-striped table-bordered">
                     <thead>
                        <tr>
                           <th class="text-center">Orden</th>
                           <th>&nbsp;</th>
                           <th class="text-center">Perfil</th>
                           <th class="text-center">Usuarios</th>
                           <th class="text-center">Estado Registro</th>
                           <th class="text-center">Módulos</th>
                           <th class="text-center">Aseguradoras</th>
                           <th class="text-center">Info</th>
                        </tr>
                     </thead>
                     <tbody>
                        {% for profile in profilesList %}
                        <tr>
                           <td class="text-center">{{ loop.index }}</td>
                           <td class="text-center">
                              {% if profile.estadoreg == 100 %}
                                 <div class="icono-bg candadito">&nbsp;</div>
                              {% elseif profile.estadoreg == 200 %}
                                 <div class="icono-bg semaforo-rojo">&nbsp;</div>
                              {% elseif profile.activo == 0 and profile.estadoreg == 0 %}
                                 <div class="icono-bg semaforo-amarillo">&nbsp;</div>
                              {% elseif profile.activo == 1 and profile.estadoreg == 0 and profile.eliminado == 0 %}
                                 <div></div>
                              {% endif %}
                           </td>
                        {% if profile.estadoreg == 200 %}
                           <td class="text-center tachado">{{ profile.perfil }}</td>
                           <td class="text-center tachado">{{ profile.users|length }}</td>
                        {% else %}
                           <td class="text-center">{{ profile.perfil }}</td>
                           <td class="text-center">{{ profile.users|length }}</td>
                        {% endif %}
                           <td class="text-center">
                           {% if profile.estadoreg == 100 %}
                              <div class="text-center">BLOQUEADO</div>
                           {% elseif profile.estadoreg == 200 %}
                              <div class="text-center">ANULADO</div>
                           {% elseif profile.activo == 0 and profile.estadoreg == 0 %}
                              <div class="text-center">INACTIVO</div>
                           {% elseif profile.activo == 1 and profile.estadoreg == 0 %}
                              <div class="text-center">ACTIVO</div>
                           {% endif %}
                           </td>
                           <td class="text-center">
                              <button type="button" class="btn btn-outline-warning">
                                 ACCESOS
                              </button>
                           </td>
                           <td class="text-center">
                              <button type="button" class="btn btn-outline-dark">
                                 <i class="fa-solid fa-ellipsis-vertical"></i><i class="fa-solid fa-ellipsis-vertical"></i>
                                    {{ profile.producto }} ({{ profile.insurers|length }})
                              </button>
                           </td>
                           <td class="text-center">
                              <a href="{{base_url('gestion/detalle')}}/{{profile.idperfil}}" class="btn btn-outline-primary">
                                 <i class="fa-solid fa-magnifying-glass"></i>Info
                              </a>
                           </td>
                        </tr>
                        {% else %}
                        <tr>
                           <td class="text-center" colspan="8">No hay registros disponibles.</td>
                        </tr>
                        {% endfor %}
                     </tbody>
                     <tfoot>
                        <tr>
                           <th class="text-center">Orden</th>
                           <th>&nbsp;</th>
                           <th class="text-center">Perfil</th>
                           <th class="text-center">Usuarios</th>
                           <th class="text-center">Estado Registro</th>
                           <th class="text-center">Módulos</th>
                           <th class="text-center">Aseguradoras</th>
                           <th class="text-center">Info</th>
                        </tr>
                     </tfoot>
                  </table>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

<!--MODALES-->
<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1"
   aria-labelledby="staticBackdropLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header" style="background-color: #089bab;">
            <h5 class="modal-title" id="staticBackdropLabel" style="color: #eff7f8;">Seleccionar Aseguradora</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true">&times;</span>
            </button>
         </div>
         <div class="modal-body">
            <div class="row">
               <div class="col-sm-6" style="text-align: center;">
                  <img src="{{ base_url('assets/images/mapfre1.png') }}" class="img-fluid rounded mr-3 image-button"
                     alt="user" style="max-width: 120px; height: auto;" id="fnMapfre" />
               </div>
               <div class="col-sm-6" style="text-align: center;">
                  <img src="{{ base_url('assets/images/pacifico.png') }}" class="img-fluid rounded mr-3 image-button"
                     alt="user" style="max-width: 120px; height: auto;" id="fnPacifico" />
               </div>
            </div>
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            <!--<button type="button" class="btn btn-primary">Confirmar</button>-->
         </div>
      </div>
   </div>
</div>

<div class="modal fade" id="modalResetPassword" tabindex="-1" role="dialog" aria-labelledby="modalResetPasswordLabel" aria-hidden="true">
   <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form id="formResetPasswd">
         <div class="modal-header">
          <h5 class="modal-title" id="modalResetPasswordLabel">Reiniciar contraseña</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
         <input type="hidden" id="frp_user_id">
          ¿Está seguro que deseas reiniciar la contraseña del usuario?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-primary">Confirmar</button>
        </div>
      </form>
      </div>
   </div>
 </div>

{% endblock %}

{% block javascriptAPP %}
<script>
   window.globalConfig = {
      baseUrl: "{{ base_url('/')|e('js') }}"
   };
</script>
<script src="{{ base_url('assets/js/data-table.js') }}"></script>
<script type="module" src="{{ base_url('assets/js/core/users-module/user-reset-passwd-controller.js') }}"></script>


{% endblock %}